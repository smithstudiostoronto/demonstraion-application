var _mobx=require('mobx');var mobx=_interopRequireWildcard(_mobx);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}var _require=

require('lodash'),keys=_require.keys,isObjectLike=_require.isObjectLike,isString=_require.isString;

var alreadyProxiedObjects=new WeakMap();

function proxify(obj){
alreadyProxiedObjects.set(obj,true);
var tracker=createObservableMap(obj);
var handler={
ownKeys:function ownKeys(target){
tracker.keys();
return Reflect.ownKeys(target);
},
get:function get(target,prop){
if(isString(prop)){
tracker.get(prop);
return target[prop];
}
return undefined;
},
set:function set(target,prop,value){
var newValue=value;
if(isObjectLike(value)&&!alreadyProxiedObjects.has(value)){
newValue=proxify(value);
}
target[prop]=newValue;
tracker.set(prop,newValue);
return true;
}};

var proxiedObject=new Proxy(obj,handler);
alreadyProxiedObjects.set(proxiedObject,true);
return proxiedObject;
}

var createObservableMap=function createObservableMap(obj){
var tracker=mobx.observable.shallowMap();
keys(obj).forEach(function(key){
if(isObjectLike(obj[key])&&!alreadyProxiedObjects.has(obj[key])){
obj[key]=proxify(obj[key]);
}
tracker.set(key,obj[key]);
});
return tracker;
};

module.exports={
proxify:proxify};